<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>aura - E-commerce</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.20.15/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    // Debounce utility function
    const debounce = (func, delay) => {
      let timeoutId;
      return (...args) => {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => func(...args), delay);
      };
    };

    // Click-outside hook
    function useOutsideClick(ref, callback) {
      React.useEffect(() => {
        const handleClickOutside = (event) => {
          if (ref.current && !ref.current.contains(event.target)) {
            callback();
          }
        };
        document.addEventListener('mousedown', handleClickOutside);
        return () => {
          document.removeEventListener('mousedown', handleClickOutside);
        };
      }, [ref, callback]);
    }

    // Error Boundary Component
    class ErrorBoundary extends React.Component {
      state = { hasError: false };

      static getDerivedStateFromError(error) {
        return { hasError: true };
      }

      render() {
        if (this.state.hasError) {
          return (
            <div className="max-w-7xl mx-auto px-4 py-8 text-center">
              <h2 className="text-2xl font-bold text-gray-900">Something went wrong.</h2>
              <p className="text-gray-600 mt-2">Please refresh the page or try again later.</p>
            </div>
          );
        }
        return this.props.children;
      }
    }

    const FreeShippingBanner = () => {
      return (
        <div className="fixed top-0 w-full bg-black text-white text-sm font-bold text-center py-2 z-50">
          Free Shipping on Orders Over UGX 1,000,000!
        </div>
      );
    };

    const VariationModal = ({ product, onAddToCart, onClose }) => {
      const [selectedSize, setSelectedSize] = React.useState(null);
      const [error, setError] = React.useState("");
      const modalRef = React.useRef(null);
      const isTablet = product.title.toLowerCase().includes("ipad");

      useOutsideClick(modalRef, onClose);

      const handleAddToCart = () => {
        if (!selectedSize) {
          setError(`Please select a ${isTablet ? "storage & RAM option" : "size"}`);
          return;
        }
        setError("");
        onAddToCart({ ...product, size: selectedSize });
        onClose();
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div ref={modalRef} className="bg-white rounded-lg shadow-lg p-6 max-w-md w-full">
            <div className="flex items-center space-x-4 mb-4">
              <img src={product.image} alt={product.title} className="w-16 h-16 object-contain rounded" />
              <h3 className="text-lg font-semibold text-gray-900">{product.title}</h3>
            </div>
            <div className="mb-4">
              <h4 className="text-sm font-medium text-gray-900 mb-2">{isTablet ? "Select Storage & RAM" : "Select Size"}</h4>
              <div className="flex space-x-2 flex-wrap gap-2">
                {product.variations.map((size) => (
                  <button
                    key={size}
                    onClick={() => setSelectedSize(size)}
                    className={`border border-gray-300 px-4 py-2 rounded-md text-sm font-medium ${
                      selectedSize === size ? 'bg-purple-500 text-white' : 'bg-white text-gray-900 hover:bg-gray-100'
                    }`}
                  >
                    {size}
                  </button>
                ))}
              </div>
              {error && <p className="text-red-500 text-sm mt-2">{error}</p>}
            </div>
            <div className="flex justify-end space-x-4">
              <button
                onClick={onClose}
                className="bg-gray-300 text-gray-900 uppercase font-bold py-2 px-4 rounded-full hover:bg-gray-400 transition text-sm"
              >
                Cancel
              </button>
              <button
                onClick={handleAddToCart}
                className="bg-purple-500 text-white uppercase font-bold py-2 px-4 rounded-full hover:bg-purple-600 transition text-sm"
              >
                Add to Cart
              </button>
            </div>
          </div>
        </div>
      );
    };

    const CheckoutModal = ({ cart, onConfirm, onClose }) => {
      const [name, setName] = React.useState("");
      const [address, setAddress] = React.useState("");
      const [phone, setPhone] = React.useState("");
      const [error, setError] = React.useState("");
      const modalRef = React.useRef(null);
      const exchangeRate = 0.00027;

      useOutsideClick(modalRef, onClose);

      const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
      const vat = subtotal * 0.18;
      const deliveryFee = 10000;
      const total = subtotal + vat + deliveryFee;
      const subtotalUSD = (subtotal * exchangeRate).toFixed(2);
      const vatUSD = (vat * exchangeRate).toFixed(2);
      const deliveryFeeUSD = (deliveryFee * exchangeRate).toFixed(2);
      const totalUSD = (total * exchangeRate).toFixed(2);

      const handleConfirm = () => {
        if (!name.trim() || !address.trim() || !phone.trim()) {
          setError("Please fill all fields");
          return;
        }
        setError("");
        onConfirm({ name, address, phone });
        onClose();
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div ref={modalRef} className="bg-white rounded-lg shadow-lg p-6 max-w-md w-full">
            <h3 className="text-lg font-semibold text-gray-900 mb-4">Enter Delivery Details</h3>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700">Full Name</label>
                <input
                  type="text"
                  value={name}
                  onChange={(e) => setName(e.target.value)}
                  className="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"
                  placeholder="John Doe"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700">Delivery Address</label>
                <textarea
                  value={address}
                  onChange={(e) => setAddress(e.target.value)}
                  className="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"
                  placeholder="123 Main St, Kampala"
                  rows="4"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700">Phone Number</label>
                <input
                  type="text"
                  value={phone}
                  onChange={(e) => setPhone(e.target.value)}
                  className="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"
                  placeholder="+256 123 456 789"
                />
              </div>
              {error && <p className="text-red-500 text-sm">{error}</p>}
            </div>
            <div className="mt-6">
              <h4 className="text-sm font-medium text-gray-900 mb-2">Order Summary</h4>
              <div className="space-y-2">
                <div className="flex justify-between text-sm">
                  <span>Subtotal:</span>
                  <div className="text-right">
                    <span>UGX {subtotal.toLocaleString()}</span>
                    <p className="text-xs text-gray-600">USD {subtotalUSD}</p>
                  </div>
                </div>
                <div className="flex justify-between text-sm">
                  <span>VAT (18%):</span>
                  <div className="text-right">
                    <span>UGX {vat.toLocaleString()}</span>
                    <p className="text-xs text-gray-600">USD {vatUSD}</p>
                  </div>
                </div>
                <div className="flex justify-between text-sm">
                  <span>Delivery Fee:</span>
                  <div className="text-right">
                    <span>UGX {deliveryFee.toLocaleString()}</span>
                    <p className="text-xs text-gray-600">USD {deliveryFeeUSD}</p>
                  </div>
                </div>
                <div className="flex justify-between text-lg font-semibold border-t pt-2">
                  <span>Total:</span>
                  <div className="text-right">
                    <span>UGX {total.toLocaleString()}</span>
                    <p className="text-xs text-gray-600">USD {totalUSD}</p>
                  </div>
                </div>
              </div>
            </div>
            <div className="flex justify-end space-x-4 mt-6">
              <button
                onClick={onClose}
                className="bg-gray-300 text-gray-900 uppercase font-bold py-2 px-4 rounded-full hover:bg-gray-400 transition text-sm"
              >
                Cancel
              </button>
              <button
                onClick={handleConfirm}
                className="bg-purple-500 text-white uppercase font-bold py-2 px-4 rounded-full hover:bg-purple-600 transition text-sm"
              >
                Confirm Order
              </button>
            </div>
          </div>
        </div>
      );
    };

    const MiniCart = ({ cart, removeFromCart, closeMiniCart, openCheckoutModal }) => {
      const exchangeRate = 0.00027;
      const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
      const subtotalUSD = (subtotal * exchangeRate).toFixed(2);

      return (
        <div className="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg z-50 p-4 max-h-96 overflow-y-auto">
          <div className="flex justify-between items-center mb-4">
            <h3 className="text-lg font-semibold text-gray-900">Your Cart</h3>
            <button onClick={closeMiniCart} className="text-gray-600 hover:text-gray-900">
              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          {cart.length === 0 ? (
            <p className="text-gray-600 text-sm">Your cart is empty.</p>
          ) : (
            <>
              {cart.map((item, index) => (
                <div key={index} className="flex items-center justify-between py-2 border-b">
                  <div className="flex items-center space-x-3">
                    <img src={item.image} alt={item.title} className="w-12 h-12 object-contain rounded" />
                    <div>
                      <h4 className="text-sm font-medium text-gray-900 truncate w-40">{item.title}</h4>
                      {item.size && <p className="text-xs text-gray-600">Size: {item.size}</p>}
                      <p className="text-xs text-gray-600">UGX {item.price.toLocaleString()} x {item.quantity}</p>
                    </div>
                  </div>
                  <button
                    onClick={() => removeFromCart(index)}
                    className="text-red-500 hover:text-red-700"
                    aria-label="Remove item from cart"
                  >
                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5-4h4M9 7v12m6-12v12M3 7h18" />
                    </svg>
                  </button>
                </div>
              ))}
              <div className="mt-4">
                <div className="flex justify-between text-lg font-semibold mb-2">
                  <span>Subtotal:</span>
                  <div className="text-right">
                    <span>UGX {subtotal.toLocaleString()}</span>
                    <p className="text-xs text-gray-600">USD {subtotalUSD}</p>
                  </div>
                </div>
                <button
                  onClick={openCheckoutModal}
                  className="w-full bg-black text-white uppercase font-bold py-2 rounded-full hover:bg-white hover:text-black hover:border hover:border-black transition text-sm"
                >
                  CHECKOUT
                </button>
              </div>
            </>
          )}
        </div>
      );
    };

    const MiniWishlist = ({ wishlist, toggleWishlist, products, closeMiniWishlist }) => {
      const exchangeRate = 0.00027;

      const wishlistItems = wishlist && Array.isArray(products.current)
        ? wishlist.map((title) => products.current.find((product) => product && product.title === title)).filter(Boolean)
        : [];

      return (
        <div className="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg z-50 p-4 max-h-96 overflow-y-auto">
          <div className="flex justify-between items-center mb-4">
            <h3 className="text-lg font-semibold text-gray-900">Your Wishlist</h3>
            <button onClick={closeMiniWishlist} className="text-gray-600 hover:text-gray-900">
              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          {wishlist.length === 0 ? (
            <p className="text-gray-600 text-sm">Your wishlist is empty.</p>
          ) : wishlistItems.length === 0 ? (
            <p className="text-gray-600 text-sm">Failed to load wishlist items.</p>
          ) : (
            <>
              {wishlistItems.map((item, index) => (
                <div key={index} className="flex items-center justify-between py-2 border-b">
                  <div className="flex items-center space-x-3">
                    <img src={item.image} alt={item.title} className="w-12 h-12 object-contain rounded" />
                    <div>
                      <h4 className="text-sm font-medium text-gray-900 truncate w-40">{item.title}</h4>
                      <p className="text-xs text-gray-600">
                        UGX {item.priceUGX.toLocaleString()}
                      </p>
                      <p className="text-xs text-gray-600">
                        USD {(item.priceUGX * exchangeRate).toFixed(2)}
                      </p>
                    </div>
                  </div>
                  <button
                    onClick={() => toggleWishlist(item.title)}
                    className="text-red-500 hover:text-red-700"
                    aria-label="Remove item from wishlist"
                  >
                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5-4h4M9 7v12m6-12v12M3 7h18" />
                    </svg>
                  </button>
                </div>
              ))}
              <button
                onClick={closeMiniWishlist}
                className="w-full bg-black text-white uppercase font-bold py-2 rounded-full hover:bg-white hover:text-black hover:border hover:border-black transition text-sm mt-4"
              >
                View Wishlist
              </button>
            </>
          )}
        </div>
      );
    };

    const Header = ({ cartItemCount, wishlistCount, searchQuery, handleSearchChange, clearSearch, cart, removeFromCart, isMiniCartOpen, toggleMiniCart, closeMiniCart, openCheckoutModal, wishlist, toggleWishlist, products, isMiniWishlistOpen, toggleMiniWishlist, closeMiniWishlist }) => {
      const cartRef = React.useRef(null);
      const wishlistRef = React.useRef(null);

      useOutsideClick(cartRef, () => {
        if (isMiniCartOpen) closeMiniCart();
      });
      useOutsideClick(wishlistRef, () => {
        if (isMiniWishlistOpen) closeMiniWishlist();
      });

      const handleKeyDown = (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
        }
      };

      return (
        <header className="bg-gray-900 text-white sticky top-8 z-40">
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
            <div className="flex items-center space-x-4">
              <h1 className="text-2xl font-bold">aura</h1>
            </div>
            <div className="flex-1 mx-4">
              <div className="relative">
                <input
                  type="text"
                  placeholder="Search products..."
                  value={searchQuery}
                  onChange={(e) => handleSearchChange(e.target.value)}
                  onKeyDown={handleKeyDown}
                  className="w-full py-2 pl-10 pr-10 rounded-full bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-yellow-400 transition"
                />
                <svg
                  className="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                {searchQuery && (
                  <button
                    onClick={clearSearch}
                    className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white"
                  >
                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                )}
              </div>
            </div>
            <div className="flex items-center space-x-4 relative">
              <a href="#" className="hover:text-yellow-400">Account</a>
              <div className="relative" ref={wishlistRef}>
                <button
                  onClick={() => {
                    toggleMiniWishlist(!isMiniWishlistOpen);
                    if (isMiniCartOpen) closeMiniCart();
                  }}
                  className="hover:text-yellow-400 relative focus:outline-none"
                >
                  Wishlist
                  {wishlistCount > 0 && (
                    <span className="absolute -top-2 -right-2 bg-yellow-400 text-gray-900 text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">
                      {wishlistCount}
                    </span>
                  )}
                </button>
                {isMiniWishlistOpen && (
                  <MiniWishlist
                    wishlist={wishlist}
                    toggleWishlist={toggleWishlist}
                    products={products}
                    closeMiniWishlist={closeMiniWishlist}
                  />
                )}
              </div>
              <div className="relative" ref={cartRef}>
                <button
                  onClick={() => {
                    toggleMiniCart(!isMiniCartOpen);
                    if (isMiniWishlistOpen) closeMiniWishlist();
                  }}
                  className="hover:text-yellow-400 relative focus:outline-none"
                >
                  Cart
                  {cartItemCount > 0 && (
                    <span className="absolute -top-2 -right-2 bg-yellow-400 text-gray-900 text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">
                      {cartItemCount}
                    </span>
                  )}
                </button>
                {isMiniCartOpen && (
                  <MiniCart
                    cart={cart}
                    removeFromCart={removeFromCart}
                    closeMiniCart={closeMiniCart}
                    openCheckoutModal={openCheckoutModal}
                  />
                )}
              </div>
            </div>
          </div>
        </header>
      );
    };

    const NavBar = () => {
      return (
        <nav className="bg-gray-800 text-white">
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="flex justify-end py-3">
              <div>
                <a href="#" className="text-yellow-400 font-semibold">Today's Deals</a>
              </div>
            </div>
          </div>
        </nav>
      );
    };

    const ProductCard = ({ title, priceUGX, originalPriceUGX, discount, image, variations, openVariationModal, addToCart, toggleWishlist, isWishlisted, isOfficialStore, isRefurbished, isGlobal, isFreeShipping }) => {
      const exchangeRate = 0.00027;
      const priceUSD = (priceUGX * exchangeRate).toFixed(2);

      return (
        <div className="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition">
          <div className="relative">
            <img src={image} alt={title} className="w-full h-48 object-contain" />
            <button
              onClick={() => toggleWishlist(title)}
              className={`absolute top-2 right-2 w-5 h-5 ${
                isWishlisted ? 'text-red-500 fill-current' : 'text-gray-600 fill-none stroke-current'
              } hover:text-red-500 transition`}
              aria-label={isWishlisted ? "Remove from wishlist" : "Add to wishlist"}
            >
              <svg viewBox="0 0 24 24" strokeWidth="2">
                <path
                  d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
                />
              </svg>
            </button>
            {discount && (
              <span className="absolute top-2 left-2 bg-orange-500 text-white text-xs font-bold py-1 px-2 rounded">
                -{discount}%
              </span>
            )}
            {isOfficialStore && (
              <span className="absolute top-2 right-10 bg-blue-500 text-white text-xs font-bold py-1 px-2 rounded">
                Official Store
              </span>
            )}
            {isRefurbished && (
              <span className="absolute top-10 left-2 bg-green-500 text-white text-xs font-bold py-1 px-2 rounded">
                Refurbished
              </span>
            )}
            {isGlobal && (
              <span className="absolute top-10 right-2 bg-purple-500 text-white text-xs font-bold py-1 px-2 rounded">
                Shipped from Abroad
              </span>
            )}
          </div>
          <div className="p-2">
            <h3 className="text-sm text-gray-900 truncate">{title}</h3>
            <div className="flex items-center justify-between mt-1">
              <p className="text-base font-semibold text-gray-900">
                UGX {priceUGX.toLocaleString()}
              </p>
              {originalPriceUGX && (
                <p className="text-sm text-gray-500 line-through">
                  UGX {originalPriceUGX.toLocaleString()}
                </p>
              )}
            </div>
            <p className="text-xs text-gray-600">
              USD {priceUSD}
            </p>
            {isFreeShipping && (
              <p className="text-xs text-green-600 mt-1">
                Free Shipping Eligible
              </p>
            )}
            {isGlobal && (
              <p className="text-xs text-purple-600 mt-1">
                May take 7-14 days for delivery
              </p>
            )}
            <button
              onClick={() => {
                if (variations && variations.length > 0) {
                  openVariationModal({ title, price: priceUGX, image, variations });
                } else {
                  addToCart({ title, price: priceUGX, image });
                }
              }}
              className="mt-2 w-full bg-black text-white uppercase font-bold py-2 rounded-full hover:bg-white hover:text-black hover:border hover:border-black transition text-sm"
            >
              Add to Cart
            </button>
          </div>
        </div>
      );
    };

    const ProductGrid = ({ openVariationModal, addToCart, toggleWishlist, wishlist, searchQuery, products }) => {
      const allProducts = [
        {
          title: "SPJ 4 Litres, Hot Air Fryer",
          priceUGX: 999400,
          originalPriceUGX: 1400000,
          discount: 29,
          image: "https://images.unsplash.com/photo-1630312481381-2d4a53a52db0?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
          isOfficialStore: true,
          isRefurbished: false,
          isGlobal: false,
          isFreeShipping: true,
          variations: []
        },
        {
          title: "Apple iPad 3 16GB Wi-Fi",
          priceUGX: 299000,
          originalPriceUGX: 700000,
          discount: 57,
          image: "https://images.unsplash.com/photo-1511707171634-5f89772885ad?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
          isOfficialStore: true,
          isRefurbished: false,
          isGlobal: false,
          isFreeShipping: false,
          variations: ["16GB (1GB RAM)", "32GB (1GB RAM)", "64GB (1GB RAM)"]
        },
        {
          title: "Refurbished Apple iPad 3 16GB Wi-Fi",
          priceUGX: 199000,
          originalPriceUGX: 500000,
          discount: 60,
          image: "https://images.unsplash.com/photo-1511707171634-5f89772885ad?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
          isOfficialStore: false,
          isRefurbished: true,
          isGlobal: false,
          isFreeShipping: false,
          variations: ["16GB (1GB RAM)", "32GB (1GB RAM)", "64GB (1GB RAM)"]
        },
        {
          title: "Hoffmans 6 Cups Electric Coffee Maker",
          priceUGX: 67500,
          originalPriceUGX: 150000,
          discount: 55,
          image: "https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
          isOfficialStore: false,
          isRefurbished: false,
          isGlobal: false,
          isFreeShipping: false,
          variations: []
        },
        {
          title: "Pixel 120 Litres Single Door Fridge",
          priceUGX: 553900,
          originalPriceUGX: 820000,
          discount: 32,
          image: "https://images.unsplash.com/photo-1588854337236-6889d6311493?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
          isOfficialStore: false,
          isRefurbished: false,
          isGlobal: true,
          isFreeShipping: false,
          variations: []
        },
        {
          title: "Kitchen Utensils 5 Piece Set",
          priceUGX: 19000,
          originalPriceUGX: 60000,
          discount: 68,
          image: "https://images.unsplash.com/photo-1600585154343-67eb9e7e8b2e?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
          isOfficialStore: false,
          isRefurbished: false,
          isGlobal: false,
          isFreeShipping: false,
          variations: ["M", "L", "XL", "XXL"]
        },
        {
          title: "Smarttec 120 Litres Single Door Fridge",
          priceUGX: 353900,
          originalPriceUGX: 550000,
          discount: 36,
          image: "https://images.unsplash.com/photo-1588854337236-6889d6311493?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
          isOfficialStore: false,
          isRefurbished: false,
          isGlobal: true,
          isFreeShipping: false,
          variations: []
        },
        {
          title: "Nike Air Max 90",
          priceUGX: 134000,
          originalPriceUGX: 167500,
          discount: 20,
          image: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
          isOfficialStore: true,
          isRefurbished: false,
          isGlobal: false,
          isFreeShipping: true,
          variations: ["M", "L", "XL", "XXL"]
        },
        {
          title: "Nike React Infinity Run",
          priceUGX: 134000,
          originalPriceUGX: 157647,
          discount: 15,
          image: "https://images.unsplash.com/photo-1600585154343-67eb9e7e8b2e?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
          isOfficialStore: true,
          isRefurbished: false,
          isGlobal: true,
          isFreeShipping: false,
          variations: ["M", "L", "XL", "XXL"]
        },
        {
          title: "Nike Free RN 5.0",
          priceUGX: 134000,
          originalPriceUGX: 178667,
          discount: 25,
          image: "https://images.unsplash.com/photo-1600585154343-67eb9e7e8b2e?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
          isOfficialStore: false,
          isRefurbished: false,
          isGlobal: false,
          isFreeShipping: false,
          variations: ["M", "L", "XL", "XXL"]
        }
      ];

      const dailyDeals = [
        {
          title: "Kitchen Utensils 5 Piece Set (Daily Deal)",
          priceUGX: 15000,
          originalPriceUGX: 60000,
          discount: 75,
          image: "https://images.unsplash.com/photo-1600585154343-67eb9e7e8b2e?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
          isOfficialStore: false,
          isRefurbished: false,
          isGlobal: false,
          isFreeShipping: false,
          variations: ["M", "L", "XL", "XXL"]
        }
      ];

      const filteredProducts = allProducts.filter((product) =>
        product.title.toLowerCase().includes(searchQuery.toLowerCase())
      );

      const filteredDailyDeals = dailyDeals.filter((product) =>
        product.title.toLowerCase().includes(searchQuery.toLowerCase())
      );

      return (
        <div className="flex-1 py-8">
          <div className="px-4 sm:px-6 lg:px-8 mb-6">
            <h2 className="text-xl font-bold mb-4">Daily Deals</h2>
            {filteredDailyDeals.length > 0 ? (
              <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                {filteredDailyDeals.map((product, index) => (
                  <ProductCard
                    key={`deal-${index}`}
                    title={product.title}
                    priceUGX={product.priceUGX}
                    originalPriceUGX={product.originalPriceUGX}
                    discount={product.discount}
                    image={product.image}
                    variations={product.variations}
                    openVariationModal={openVariationModal}
                    addToCart={addToCart}
                    toggleWishlist={toggleWishlist}
                    isWishlisted={wishlist.includes(product.title)}
                    isOfficialStore={product.isOfficialStore}
                    isRefurbished={product.isRefurbished}
                    isGlobal={product.isGlobal}
                    isFreeShipping={product.isFreeShipping}
                  />
                ))}
              </div>
            ) : (
              <p className="text-gray-600">No daily deals match your search.</p>
            )}
          </div>

          <div className="px-4 sm:px-6 lg:px-8 mb-6">
            <h2 className="text-xl font-bold mb-4">Recommended for You</h2>
            <p className="text-gray-600">Personalized recommendations coming soon!</p>
          </div>

          <h2 className="text-2xl font-bold mb-6 px-4 sm:px-6 lg:px-8">
            {searchQuery ? `Search Results for "${searchQuery}"` : `All Products`}
          </h2>
          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 px-4 sm:px-6 lg:px-8">
            {filteredProducts.length > 0 ? (
              filteredProducts.map((product, index) => (
                <ProductCard
                  key={index}
                  title={product.title}
                  priceUGX={product.priceUGX}
                  originalPriceUGX={product.originalPriceUGX}
                  discount={product.discount}
                  image={product.image}
                  variations={product.variations}
                  openVariationModal={openVariationModal}
                  addToCart={addToCart}
                  toggleWishlist={toggleWishlist}
                  isWishlisted={wishlist.includes(product.title)}
                  isOfficialStore={product.isOfficialStore}
                  isRefurbished={product.isRefurbished}
                  isGlobal={product.isGlobal}
                  isFreeShipping={product.isFreeShipping}
                />
              ))
            ) : (
              <p className="col-span-full text-gray-600">No products found matching your search.</p>
            )}
          </div>
        </div>
      );
    };

    const CartSummary = ({ cart, removeFromCart, updateQuantity }) => {
      const exchangeRate = 0.00027;
      const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
      const subtotalUSD = (subtotal * exchangeRate).toFixed(2);
      const shippingThreshold = 1000000;
      const shippingCost = subtotal >= shippingThreshold ? 0 : 20000;
      const shippingCostUSD = (shippingCost * exchangeRate).toFixed(2);
      const total = subtotal + shippingCost;
      const totalUSD = (total * exchangeRate).toFixed(2);

      const handleQuantityChange = (index, newQuantity) => {
        if (newQuantity < 1) return;
        updateQuantity(index, newQuantity);
      };

      if (cart.length === 0) {
        return (
          <div id="cart" className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 bg-white">
            <h2 className="text-2xl font-bold mb-6">Your Cart</h2>
            <p className="text-gray-600">Your cart is empty.</p>
          </div>
        );
      }

      return (
        <div id="cart" className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 bg-white">
          <h2 className="text-2xl font-bold mb-6">Your Cart</h2>
          <div className="flex flex-col lg:flex-row gap-8">
            <div className="flex-1">
              {cart.map((item, index) => {
                const itemUSD = (item.price * exchangeRate).toFixed(2);
                return (
                  <div key={index} className="flex items-center justify-between border-b py-4">
                    <div className="flex items-center space-x-4">
                      <img src={item.image} alt={item.title} className="w-16 h-16 object-contain rounded" />
                      <div>
                        <h3 className="text-lg font-semibold text-gray-900">{item.title}</h3>
                        {item.size && <p className="text-xs text-gray-600">Size: {item.size}</p>}
                        <p className="text-gray-600">
                          UGX {item.price.toLocaleString()}
                        </p>
                        <p className="text-xs text-gray-600">
                          USD {itemUSD}
                        </p>
                        <div className="flex items-center mt-1">
                          <label className="text-sm text-gray-600 mr-2">Qty:</label>
                          <select
                            value={item.quantity}
                            onChange={(e) => handleQuantityChange(index, parseInt(e.target.value))}
                            className="border rounded px-2 py-1 text-sm"
                          >
                            {[1, 2, 3, 4, 5].map((num) => (
                              <option key={num} value={num}>{num}</option>
                            ))}
                          </select>
                        </div>
                      </div>
                    </div>
                    <button
                      onClick={() => removeFromCart(index)}
                      className="text-red-500 hover:text-red-700 text-sm"
                    >
                      Remove
                    </button>
                  </div>
                );
              })}
            </div>

            <div className="lg:w-1/3 bg-gray-50 p-6 rounded-lg shadow-md">
              <h3 className="text-lg font-semibold mb-4">Order Summary</h3>
              <div className="mb-4">
                <p className="text-sm text-gray-600 mb-1">
                  {subtotal >= shippingThreshold
                    ? "Congrats! You qualify for free shipping."
                    : `Add UGX ${(shippingThreshold - subtotal).toLocaleString()} more for free shipping`}
                </p>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div
                    className="bg-orange-500 h-2 rounded-full"
                    style={{ width: `${Math.min((subtotal / shippingThreshold) * 100, 100)}%` }}
                  ></div>
                </div>
              </div>
              <div className="space-y-2">
                <div className="flex justify-between text-sm">
                  <span>Subtotal:</span>
                  <div className="text-right">
                    <span>UGX {subtotal.toLocaleString()}</span>
                    <p className="text-xs text-gray-600">USD {subtotalUSD}</p>
                  </div>
                </div>
                <div className="flex justify-between text-sm">
                  <span>Estimated Shipping:</span>
                  <div className="text-right">
                    <span>{shippingCost === 0 ? "Free" : `UGX ${shippingCost.toLocaleString()}`}</span>
                    {shippingCost !== 0 && (
                      <p className="text-xs text-gray-600">USD {shippingCostUSD}</p>
                    )}
                  </div>
                </div>
                <div className="flex justify-between text-lg font-semibold border-t pt-2">
                  <span>Total:</span>
                  <div className="text-right">
                    <span>UGX {total.toLocaleString()}</span>
                    <p className="text-xs text-gray-600">USD {totalUSD}</p>
                  </div>
                </div>
              </div>
              <div className="mt-4">
                <p className="text-sm text-gray-600">Payment Options:</p>
                <p className="text-xs text-gray-600">Cash on Delivery, Credit/Debit Card, Mobile Money</p>
                <p className="text-xs text-gray-600 mt-1">Buy Now, Pay Later available</p>
              </div>
              <div className="mt-4">
                <p className="text-sm text-gray-600">Track your order after checkout!</p>
              </div>
              <div className="flex justify-center space-x-4 mt-4">
                <span className="text-xs text-gray-600 flex items-center">
                  <svg className="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 2a8 8 0 00-8 8c0 2.2 1.8 4 4 4h2v2h4v-2h2c2.2 0 4-1.8 4-4a8 8 0 00-8-8zm-2 9H6V9h2v2zm0-4H6V5h2v2zm6 4h-2V9h2v2zm0-4h-2V5h2v2z" />
                  </svg>
                  Secure Checkout
                </span>
              </div>
              <button
                className="w-full bg-black text-white uppercase font-bold py-3 rounded-full hover:bg-white hover:text-black hover:border hover:border-black transition mt-4"
              >
                Proceed to Checkout
              </button>
              <a
                href="#"
                className="block text-center text-gray-600 text-sm mt-2 hover:underline"
              >
                Continue Shopping
              </a>
            </div>
          </div>
        </div>
      );
    };

    const Footer = () => {
      return (
        <footer className="bg-gray-900 text-white py-8">
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
              <div>
                <h3 className="text-lg font-semibold">Get to Know Us</h3>
                <ul className="mt-4 space-y-2">
                  <li><a href="#" className="hover:text-yellow-400">About Us</a></li>
                  <li><a href="#" className="hover:text-yellow-400">Careers</a></li>
                </ul>
              </div>
              <div>
                <h3 className="text-lg font-semibold">Make Money with Us</h3>
                <ul className="mt-4 space-y-2">
                  <li><a href="#" className="hover:text-yellow-400">Sell on aura</a></li>
                  <li><a href="#" className="hover:text-yellow-400">Affiliate Program</a></li>
                </ul>
              </div>
              <div>
                <h3 className="text-lg font-semibold">Customer Service</h3>
                <ul className="mt-4 space-y-2">
                  <li><a href="#" className="hover:text-yellow-400">Help</a></li>
                  <li><a href="#" className="hover:text-yellow-400">Contact Us</a></li>
                  <li><a href="#" className="hover:text-yellow-400">Returns & Refunds</a></li>
                </ul>
              </div>
              <div>
                <h3 className="text-lg font-semibold">Payment Methods</h3>
                <ul className="mt-4 space-y-2">
                  <li><a href="#" className="hover:text-yellow-400">Credit Cards</a></li>
                  <li><a href="#" className="hover:text-yellow-400">aura Points</a></li>
                </ul>
              </div>
            </div>
            <div className="mt-8 text-center">
              <p>© 2025 aura. All rights reserved.</p>
            </div>
          </div>
        </footer>
      );
    };

    const App = () => {
      const [cart, setCart] = React.useState([]);
      const [wishlist, setWishlist] = React.useState([]);
      const [searchQuery, setSearchQueryState] = React.useState("");
      const [isMiniCartOpen, setIsMiniCartOpen] = React.useState(false);
      const [isMiniWishlistOpen, setIsMiniWishlistOpen] = React.useState(false);
      const [isVariationModalOpen, setIsVariationModalOpen] = React.useState(false);
      const [isCheckoutModalOpen, setIsCheckoutModalOpen] = React.useState(false);
      const [selectedProduct, setSelectedProduct] = React.useState(null);
      const productsRef = React.useRef([]);

      React.useEffect(() => {
        const allProducts = [
          {
            title: "SPJ 4 Litres, Hot Air Fryer",
            priceUGX: 999400,
            originalPriceUGX: 1400000,
            discount: 29,
            image: "https://images.unsplash.com/photo-1630312481381-2d4a53a52db0?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
            isOfficialStore: true,
            isRefurbished: false,
            isGlobal: false,
            isFreeShipping: true,
            variations: []
          },
          {
            title: "Apple iPad 3 16GB Wi-Fi",
            priceUGX: 299000,
            originalPriceUGX: 700000,
            discount: 57,
            image: "https://images.unsplash.com/photo-1511707171634-5f89772885ad?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
            isOfficialStore: true,
            isRefurbished: false,
            isGlobal: false,
            isFreeShipping: false,
            variations: ["16GB (1GB RAM)", "32GB (1GB RAM)", "64GB (1GB RAM)"]
          },
          {
            title: "Refurbished Apple iPad 3 16GB Wi-Fi",
            priceUGX: 199000,
            originalPriceUGX: 500000,
            discount: 60,
            image: "https://images.unsplash.com/photo-1511707171634-5f89772885ad?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
            isOfficialStore: false,
            isRefurbished: true,
            isGlobal: false,
            isFreeShipping: false,
            variations: ["16GB (1GB RAM)", "32GB (1GB RAM)", "64GB (1GB RAM)"]
          },
          {
            title: "Hoffmans 6 Cups Electric Coffee Maker",
            priceUGX: 67500,
            originalPriceUGX: 150000,
            discount: 55,
            image: "https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
            isOfficialStore: false,
            isRefurbished: false,
            isGlobal: false,
            isFreeShipping: false,
            variations: []
          },
          {
            title: "Pixel 120 Litres Single Door Fridge",
            priceUGX: 553900,
            originalPriceUGX: 820000,
            discount: 32,
            image: "https://images.unsplash.com/photo-1588854337236-6889d6311493?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
            isOfficialStore: false,
            isRefurbished: false,
            isGlobal: true,
            isFreeShipping: false,
            variations: []
          },
          {
            title: "Kitchen Utensils 5 Piece Set",
            priceUGX: 19000,
            originalPriceUGX: 60000,
            discount: 68,
            image: "https://images.unsplash.com/photo-1600585154343-67eb9e7e8b2e?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
            isOfficialStore: false,
            isRefurbished: false,
            isGlobal: false,
            isFreeShipping: false,
            variations: ["M", "L", "XL", "XXL"]
          },
          {
            title: "Smarttec 120 Litres Single Door Fridge",
            priceUGX: 353900,
            originalPriceUGX: 550000,
            discount: 36,
            image: "https://images.unsplash.com/photo-1588854337236-6889d6311493?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
            isOfficialStore: false,
            isRefurbished: false,
            isGlobal: true,
            isFreeShipping: false,
            variations: []
          },
          {
            title: "Nike Air Max 90",
            priceUGX: 134000,
            originalPriceUGX: 167500,
            discount: 20,
            image: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
            isOfficialStore: true,
            isRefurbished: false,
            isGlobal: false,
            isFreeShipping: true,
            variations: ["M", "L", "XL", "XXL"]
          },
          {
            title: "Nike React Infinity Run",
            priceUGX: 134000,
            originalPriceUGX: 157647,
            discount: 15,
            image: "https://images.unsplash.com/photo-1600585154343-67eb9e7e8b2e?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
            isOfficialStore: true,
            isRefurbished: false,
            isGlobal: true,
            isFreeShipping: false,
            variations: ["M", "L", "XL", "XXL"]
          },
          {
            title: "Nike Free RN 5.0",
            priceUGX: 134000,
            originalPriceUGX: 178667,
            discount: 25,
            image: "https://images.unsplash.com/photo-1600585154343-67eb9e7e8b2e?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
            isOfficialStore: false,
            isRefurbished: false,
            isGlobal: false,
            isFreeShipping: false,
            variations: ["M", "L", "XL", "XXL"]
          }
        ];

        const dailyDeals = [
          {
            title: "Kitchen Utensils 5 Piece Set (Daily Deal)",
            priceUGX: 15000,
            originalPriceUGX: 60000,
            discount: 75,
            image: "https://images.unsplash.com/photo-1600585154343-67eb9e7e8b2e?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
            isOfficialStore: false,
            isRefurbished: false,
            isGlobal: false,
            isFreeShipping: false,
            variations: ["M", "L", "XL", "XXL"]
          }
        ];

        productsRef.current = [...allProducts, ...dailyDeals];
      }, []);

      const handleSearchChange = React.useCallback(
        debounce((value) => {
          setSearchQueryState(value);
        }, 300),
        []
      );

      const clearSearch = () => {
        setSearchQueryState("");
      };

      const toggleMiniCart = (isOpen) => {
        setIsMiniCartOpen(isOpen);
      };

      const toggleMiniWishlist = (isOpen) => {
        setIsMiniWishlistOpen(isOpen);
      };

      const closeMiniCart = () => {
        setIsMiniCartOpen(false);
      };

      const closeMiniWishlist = () => {
        setIsMiniWishlistOpen(false);
      };

      const openCheckoutModal = () => {
        if (cart.length === 0) return;
        setIsCheckoutModalOpen(true);
        closeMiniCart();
      };

      const closeCheckoutModal = () => {
        setIsCheckoutModalOpen(false);
      };

      const confirmOrder = ({ name, address, phone }) => {
        alert(`Order confirmed! Details: ${name}, ${address}, ${phone}`);
        setCart([]);
      };

      const openVariationModal = (product) => {
        setSelectedProduct(product);
        setIsVariationModalOpen(true);
      };

      const closeVariationModal = () => {
        setIsVariationModalOpen(false);
        setSelectedProduct(null);
      };

      const addToCart = (product) => {
        const { title, price, image, size } = product;
        setCart((prevCart) => {
          const existingItem = prevCart.find(
            (item) => item.title === title && (!item.size || !size || item.size === size)
          );
          if (existingItem) {
            return prevCart.map((item) =>
              item.title === title && (!item.size || !size || item.size === size)
                ? { ...item, quantity: item.quantity + 1 }
                : item
            );
          }
          return [...prevCart, { title, price, image, quantity: 1, ...(size && { size }) }];
        });
      };

      const removeFromCart = (index) => {
        setCart((prevCart) => prevCart.filter((_, i) => i !== index));
      };

      const updateQuantity = (index, newQuantity) => {
        setCart((prevCart) =>
          prevCart.map((item, i) =>
            i === index ? { ...item, quantity: newQuantity } : item
          )
        );
      };

      const toggleWishlist = (productTitle) => {
        setWishlist((prevWishlist) => {
          if (prevWishlist.includes(productTitle)) {
            return prevWishlist.filter((title) => title !== productTitle);
          } else {
            return [...prevWishlist, productTitle];
          }
        });
      };

      const cartItemCount = cart.reduce((sum, item) => sum + item.quantity, 0);
      const wishlistCount = wishlist.length;

      return (
        <ErrorBoundary>
          <div className="min-h-screen bg-gray-100">
            <FreeShippingBanner />
            <Header
              cartItemCount={cartItemCount}
              wishlistCount={wishlistCount}
              searchQuery={searchQuery}
              handleSearchChange={handleSearchChange}
              clearSearch={clearSearch}
              cart={cart}
              removeFromCart={removeFromCart}
              isMiniCartOpen={isMiniCartOpen}
              toggleMiniCart={toggleMiniCart}
              closeMiniCart={closeMiniCart}
              openCheckoutModal={openCheckoutModal}
              wishlist={wishlist}
              toggleWishlist={toggleWishlist}
              products={productsRef}
              isMiniWishlistOpen={isMiniWishlistOpen}
              toggleMiniWishlist={toggleMiniWishlist}
              closeMiniWishlist={closeMiniWishlist}
            />
            <NavBar />
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <ProductGrid
                openVariationModal={openVariationModal}
                addToCart={addToCart}
                toggleWishlist={toggleWishlist}
                wishlist={wishlist}
                searchQuery={searchQuery}
                products={productsRef}
              />
            </div>
            <CartSummary cart={cart} removeFromCart={removeFromCart} updateQuantity={updateQuantity} />
            {isVariationModalOpen && selectedProduct && (
              <VariationModal
                product={selectedProduct}
                onAddToCart={addToCart}
                onClose={closeVariationModal}
              />
            )}
            {isCheckoutModalOpen && (
              <CheckoutModal
                cart={cart}
                onConfirm={confirmOrder}
                onClose={closeCheckoutModal}
              />
            )}
            <Footer />
          </div>
        </ErrorBoundary>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
